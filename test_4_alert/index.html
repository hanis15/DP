<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>DP_v1</title>
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="source/main.js"></script>
    <style>
        .node {
          stroke: #000;
          fill: #ccc;
          stroke-width: .5px;
        }

        .link {
          stroke: #9ecae1;
          stroke-width: 1.5px;
        }
    </style>
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <!-- Menu -->
        <div class="navbar-inner">
            <div class="container">
                <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="brand" href="index.html">DP v1</a>
                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li class="active"><a href="index.html">Topology map</a></li>
                        <li><a href="graph.html">Graph</a></li>
                        <li><a href="setting.html">Setting</a></li>
                        <li><a href="about.html">About</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Obsah stranky -->
        <div class="container">
            <h1>Topology map</h1>
            <p>Zde bude canvas s topologickou mapou</p>
            <div id="d3_graph" style="border: 1px solid black;"></div>
            <script>
                var width = document.getElementById('d3_graph').offsetWidth;
                var height = 600;
                var force = d3.layout.force()
                    .charge(120)
                    .linkDistance(100)
                    .size([width, height]);
                
                var svg = d3.select("#d3_graph").append("svg")
                    .attr("width", width)
                    .attr("height", height);

                d3.select("#d3_graph").attr("width", width).attr("height", height);


                d3.json("draft_v1.json", function (error, data) {
                    if (error) throw error;
/*                    var edges = [];
                    // uprava souradnic aby mohl prvni najit odpovidajici uzel a pak az jeho koordinaty
                    data.routes.forEach(function (e) {
                        var sourceNode = data.networks.filter(function (n) {
                            return n.name === e.source;
                        })[0],
                            targetNode = data.networks.filter(function (n) {
                                return n.name === e.target;
                            })[0];

                        edges.push({
                            source: sourceNode,
                            targer: targetNode,
                            name: e.name
                        });
                    });
*/
                    force
                        .nodes(data.networks)
                        .links(data.routes);
                        

                    var link = svg.selectAll(".link")
                        .data(data.routes)
                        .enter().append("line")
                        .attr("class", "link")
                        .style("stroke-width", function (d) { return d.bandwidth / 100; })
                        .on("click", line_mouse_over);
                        //.on("mouseOver", line_mouse_over);


                    link.append("title")
                        .text(function (d) { return d.name; });

                    var node = svg.selectAll(".node")
                        .data(data.networks)
                        .enter().append("circle")
                        .attr("class", "node")
                        .attr("r", 20)
                        .attr("fill", function(d) { return "red"; })
                        .call(force.drag)
                        .on("click", node_mouse_click);

                    node.append("title")
                        .text(function (d) {
                            return d.name;
                        });

                    force.on("tick", function () {
                        link.attr("x1", function (d) { return d.source.x; })
                            .attr("y1", function (d) { return d.source.y; })
                            .attr("y2", function (d) { return d.target.y; })
                            .attr("x2", function (d) { return d.target.x; });

                        node.attr("cx", function (d) { return d.x; })
                            .attr("cy", function (d) { return d.y; });
                    });

                    force.start();

                    function node_mouse_click() {
                        alert("Node: " + d3.select(this).text());

/* otevreni noveho okna - moznost otevreni okna s nactenyma hodnotama z flowmon
                        window.open(this.href, "targetWindow",
                                   "toolbar=no, location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=SomeSize,height=SomeSize");
*/
                        }

                    function line_mouse_click() {
                        alert("Link: " + d3.select(this).text());
                    }

                    function line_mouse_over() {
                        var force2 = d3.layout.force()
                                        .charge(120)
                                        .linkDistance(100)
                                        .size([width/2, height/2]);

                        d3.select(this).append("svg")
                            .attr("width", width/2)
                            .attr("height", height / 2);
                        d3.json("draft_v1.json", function (error, data) {
                            if (error) throw error;
                            /*                    var edges = [];
                                                // uprava souradnic aby mohl prvni najit odpovidajici uzel a pak az jeho koordinaty
                                                data.routes.forEach(function (e) {
                                                    var sourceNode = data.networks.filter(function (n) {
                                                        return n.name === e.source;
                                                    })[0],
                                                        targetNode = data.networks.filter(function (n) {
                                                            return n.name === e.target;
                                                        })[0];
                            
                                                    edges.push({
                                                        source: sourceNode,
                                                        targer: targetNode,
                                                        name: e.name
                                                    });
                                                });
                            */
                            force2
                                .nodes(data.networks)
                                .links(data.routes);


                            var link = svg.selectAll(".link")
                                .data(data.routes)
                                .enter().append("line")
                                .attr("class", "link")
                                .style("stroke-width", function (d) { return d.bandwidth / 100; })
                                .on("click", line_mouse_click);


                            link.append("title")
                                .text(function (d) { return d.name; });

                            var node = svg.selectAll(".node")
                                .data(data.networks)
                                .enter().append("circle")
                                .attr("class", "node")
                                .attr("r", 20)
                                .attr("fill", function (d) { return "red"; })
                                .call(force.drag)
                                .on("click", node_mouse_click);

                            node.append("title")
                                .text(function (d) {
                                    return d.name;
                                });

                            force2.on("tick", function () {
                                link.attr("x1", function (d) { return d.source.x; })
                                    .attr("y1", function (d) { return d.source.y; })
                                    .attr("y2", function (d) { return d.target.y; })
                                    .attr("x2", function (d) { return d.target.x; });

                                node.attr("cx", function (d) { return d.x; })
                                    .attr("cy", function (d) { return d.y; });
                            });

                            force2.start();

                            function node_mouse_click() {
                                alert("Node: " + d3.select(this).text());

                                /* otevreni noveho okna - moznost otevreni okna s nactenyma hodnotama z flowmon
                                                        window.open(this.href, "targetWindow",
                                                                   "toolbar=no, location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=SomeSize,height=SomeSize");
                                */
                            }

                            function line_mouse_click() {
                                alert("Link: " + d3.select(this).text());
                            }
                        });
                    }
                });

            </script>
        </div>
    </div>
</body>
</html>